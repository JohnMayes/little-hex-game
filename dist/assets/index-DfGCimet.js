var ss=Object.defineProperty;var oi=i=>{throw TypeError(i)};var ns=(i,t,e)=>t in i?ss(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var ve=(i,t,e)=>ns(i,typeof t!="symbol"?t+"":t,e),be=(i,t,e)=>t.has(i)||oi("Cannot "+e);var z=(i,t,e)=>(be(i,t,"read from private field"),e?e.call(i):t.get(i)),jt=(i,t,e)=>t.has(i)?oi("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),we=(i,t,e,s)=>(be(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),j=(i,t,e)=>(be(i,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const rs=.5;let zt=!0,os="Escape",ht=!1,wt=[],ut=!1,mt=!1,Bt=!1,_t=!1,Me,Qt;function y(i,t){t?console.assert(i,t):console.assert(i)}function $t(i,t=h(),e="#fff",s=0,n=0,r=!1){y(typeof e=="string","pass in css color strings"),wt.push({pos:i,size:h(t),color:e,time:new Xe(s),angle:n,fill:r})}function ai(i,t=0,e="#fff",s=0,n=!1){y(typeof e=="string","pass in css color strings"),wt.push({pos:i,size:t,color:e,time:new Xe(s),angle:0,fill:n})}function Ii(i,t,e,s){y(typeof t=="string","pass in css color strings"),$t(i,void 0,t,e,s)}function He(i,t,e,s=.1,n){const r=h((t.x-i.x)/2,(t.y-i.y)/2),o=h(s,r.length()*2);$t(i.add(r),o,e,n,r.angle(),!0)}function ci(i,t,e,s,n){const r=h(yt(i.x-t.x/2,e.x-s.x/2),yt(i.y-t.y/2,e.y-s.y/2)),o=h(xt(i.x+t.x/2,e.x+s.x/2),xt(i.y+t.y/2,e.y+s.y/2));$t(r.lerp(o,.5),o.subtract(r),n)}function as(i,t,e=1,s="#fff",n=0,r=0,o="monospace"){y(typeof s=="string","pass in css color strings"),wt.push({text:i,pos:t,size:e,color:s,time:new Xe(n),angle:r,font:o})}function cs(i,t="screenshot",e="image/png"){ls(i.toDataURL(e),t)}function ls(i,t){Qt.download=t,Qt.href=i,Qt.click()}function hs(){Qt=document.createElement("a")}function us(){K(os)&&(ht=!ht),ht&&(K("Digit0")&&(zt=!zt),K("Digit1")&&(ut=!ut,Bt=!1),K("Digit2")&&(Bt=!Bt,ut=!1),K("Digit3")&&(_t=!_t),K("Digit4")&&(mt=!mt),K("Digit5")&&(Me=1))}function ds(){if(_e(F),Me){_e(F,!0),F.drawImage(Z,0,0),Z.width|=0;const t=T.width,e=T.height;g.fillRect(0,0,t,e),g.drawImage(T,0,0),cs(Z),Me=0}if(_t&&Ts&&navigator.getGamepads){const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e];if(s){const o=A,a=Oe[e];for(let c=a.length;c--;){const l=o.add(h(c*1*2,e*1*3)),d=l.add(a[c].scale(1));ai(l,1,"#fff7",0,!0),He(l,d,"#f00"),Ii(d,"#f00")}for(let c=s.buttons.length;c--;){const l=o.add(h(c*.2*2,e*1*3-1-.2)),d=s.buttons[c].pressed;ai(l,.2,d?"#f00":"#fff7",0,!0),as(""+c,l,.2)}}}}let i;if(ht){const t=F;F=g;const e=Rs();$t(A,e.subtract(h(.1)),"#f008");let s=1/0;for(const n of et){if(n.canvas||n.destroyed||(n.renderDebugInfo(),!n.size.x||!n.size.y))continue;const r=O.distanceSquared(n.pos);r<s&&(s=r,i=n)}vt.x>0&&vt.y>0&&kt(O.floor().add(h(.5)),h(1),D(0,0,1,.5),0,!1),F=t}{g.lineWidth=2;const t=rs*B;wt.forEach(e=>{g.save();const s=Je(e.pos);if(g.translate(s.x|0,s.y|0),g.rotate(e.angle),g.scale(1,e.text?1:-1),g.fillStyle=g.strokeStyle=e.color,e.text!=null)g.font=e.size*B+"px "+e.font,g.textAlign="center",g.textBaseline="middle",g.fillText(e.text,0,0);else if(e.points!=null){g.beginPath();for(const n of e.points){const r=n.scale(B).floor();g.lineTo(r.x,r.y)}g.closePath(),e.fill&&g.fill(),g.stroke()}else if(e.size==0||e.size.x===0&&e.size.y===0)g.fillRect(-t/2,-1,t,3),g.fillRect(-1,-t/2,3,t);else if(e.size.x!=null){const n=e.size.scale(B).floor(),r=n.x,o=n.y;e.fill&&g.fillRect(-r/2|0,-o/2|0,r,o),g.strokeRect(-r/2|0,-o/2|0,r,o)}else g.beginPath(),g.arc(0,0,e.size*B,0,9),e.fill&&g.fill(),g.stroke();g.restore()}),wt=wt.filter(e=>e.time<0)}if(i){const t=F;F=g;const e=ks(i.pos,O);e&&kt(e.floor().add(h(.5)),h(1),D(0,1,1,.3)),pt(O,i.pos,.1,e?D(1,0,0,.5):D(0,1,0,.5),!1);const s="mouse pos = "+O+`
mouse collision = `+Bi(O)+`

--- object info ---
`+i.toString();Ri(s,bt,24,D(),.05,void 0,"center","monospace"),F=t}{g.save(),g.fillStyle="#fff",g.textAlign="left",g.textBaseline="top",g.font="28px monospace",g.shadowColor="#000",g.shadowBlur=9;let t=9,e=-20,s=30;if(ht){g.fillText(Wi,t,e+=s),g.fillText("Objects: "+et.length,t,e+=s),g.fillText("Time: "+gs(V),t,e+=s),g.fillText("---------",t,e+=s),g.fillStyle="#f00",g.fillText("ESC: Debug Overlay",t,e+=s),g.fillStyle=ut?"#f00":"#fff",g.fillText("1: Debug Physics",t,e+=s),g.fillStyle=Bt?"#f00":"#fff",g.fillText("2: Debug Particles",t,e+=s),g.fillStyle=_t?"#f00":"#fff",g.fillText("3: Debug Gamepads",t,e+=s),g.fillStyle=mt?"#f00":"#fff",g.fillText("4: Debug Raycasts",t,e+=s),g.fillStyle="#fff",g.fillText("5: Save Screenshot",t,e+=s);let n="";for(const o in H[0])Q(o,0)&&(n+=o+" ");n&&g.fillText("Keys Down: "+n,t,e+=s);let r="";if(H[1])for(const o in H[1])Q(o,1)&&(r+=o+" ");r&&g.fillText("Gamepad: "+r,t,e+=s)}else g.fillText(ut?"Debug Physics":"",t,e+=s),g.fillText(Bt?"Debug Particles":"",t,e+=s),g.fillText(mt?"Debug Raycasts":"",t,e+=s),g.fillText(_t?"Debug Gamepads":"",t,e+=s);g.restore()}}const fs=Math.PI;function ct(i){return Math.abs(i)}function yt(i,t){return Math.min(i,t)}function xt(i,t){return Math.max(i,t)}function Nt(i){return Math.sign(i)}function De(i,t=1){return(i%t+t)%t}function M(i,t=0,e=1){return i<t?t:i>e?e:i}function Wt(i,t,e){return(e-=t)?M((i-t)/e):0}function Et(i,t,e){return t+M(i)*(e-t)}function Ee(i,t,e,s=h()){return ct(i.x-e.x)*2<t.x+s.x&&ct(i.y-e.y)*2<t.y+s.y}function gs(i){return(i/60|0)+":"+(i%60<10?"0":"")+(i%60|0)}function Rt(i=1,t=0){return t+Math.random()*(i-t)}function ps(i=1){return new R().setAngle(Rt(2*fs),i)}function h(i=0,t){return typeof i=="number"?new R(i,t??i):new R(i.x,i.y)}function N(i){return i instanceof R}class R{constructor(t=0,e=0){this.x=t,this.y=e,y(this.isValid())}set(t=0,e=0){return this.x=t,this.y=e,y(this.isValid()),this}copy(){return new R(this.x,this.y)}add(t){return y(N(t)),new R(this.x+t.x,this.y+t.y)}subtract(t){return y(N(t)),new R(this.x-t.x,this.y-t.y)}multiply(t){return y(N(t)),new R(this.x*t.x,this.y*t.y)}divide(t){return y(N(t)),new R(this.x/t.x,this.y/t.y)}scale(t){return y(!N(t)),new R(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return y(N(t)),this.distanceSquared(t)**.5}distanceSquared(t){return y(N(t)),(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new R(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return y(N(t)),this.x*t.x+this.y*t.y}cross(t){return y(N(t)),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new R(this.x*e-this.y*s,this.x*s+this.y*e)}setDirection(t,e=1){return t=De(t,4),y(t==0||t==1||t==2||t==3),h(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return ct(this.x)>ct(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new R(this.y,-this.x)}floor(){return new R(Math.floor(this.x),Math.floor(this.y))}area(){return ct(this.x*this.y)}lerp(t,e){return y(N(t)),this.add(t.subtract(this).scale(M(e)))}arrayCheck(t){return y(N(t)),this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}isValid(){return typeof this.x=="number"&&!isNaN(this.x)&&typeof this.y=="number"&&!isNaN(this.y)}}function D(i,t,e,s){return new v(i,t,e,s)}function Mi(i,t,e,s){return new v().setHSLA(i,t,e,s)}function It(i){return i instanceof v}class v{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n,y(this.isValid())}set(t=1,e=1,s=1,n=1){return this.r=t,this.g=e,this.b=s,this.a=n,y(this.isValid()),this}copy(){return new v(this.r,this.g,this.b,this.a)}add(t){return y(It(t)),new v(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return y(It(t)),new v(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return y(It(t)),new v(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return y(It(t)),new v(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new v(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new v(M(this.r),M(this.g),M(this.b),M(this.a))}lerp(t,e){return y(It(t)),this.add(t.subtract(this).scale(M(e)))}setHSLA(t=0,e=0,s=1,n=1){t=De(t,1),e=M(e),s=M(s);const r=s<.5?s*(1+e):s+e-s*e,o=2*s-r,a=(c,l,d)=>(d=De(d,1))*6<1?c+(l-c)*6*d:d*2<1?l:d*3<2?c+(l-c)*(4-d*6):c;return this.r=a(o,r,t+1/3),this.g=a(o,r,t),this.b=a(o,r,t-1/3),this.a=n,y(this.isValid()),this}HSLA(){const t=M(this.r),e=M(this.g),s=M(this.b),n=M(this.a),r=Math.max(t,e,s),o=Math.min(t,e,s),a=(r+o)/2;let c=0,l=0;if(r!=o){let d=r-o;l=a>.5?d/(2-r-o):d/(r+o),t==r?c=(e-s)/d+(e<s?6:0):e==r?c=(s-t)/d+2:s==r&&(c=(t-e)/d+4)}return[c/6,l,a,n]}mutate(t=.05,e=0){return new v(this.r+Rt(t,-t),this.g+Rt(t,-t),this.b+Rt(t,-t),this.a+Rt(e,-e)).clamp()}toString(t=!0){const e=s=>((s=M(s)*255|0)<16?"0":"")+s.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){if(y(typeof t=="string"&&t[0]=="#"),y([4,5,7,9].includes(t.length),"Invalid hex"),t.length<6){const e=s=>M(parseInt(t[s],16)/15);this.r=e(1),this.g=e(2),this.b=e(3),this.a=t.length==5?e(4):1}else{const e=s=>M(parseInt(t.slice(s,s+2),16)/255);this.r=e(1),this.g=e(3),this.b=e(5),this.a=t.length==9?e(7):1}return y(this.isValid()),this}rgbaInt(){const t=M(this.r)*255|0,e=M(this.g)*255<<8,s=M(this.b)*255<<16,n=M(this.a)*255<<24;return t+e+s+n}isValid(){return typeof this.r=="number"&&!isNaN(this.r)&&typeof this.g=="number"&&!isNaN(this.g)&&typeof this.b=="number"&&!isNaN(this.b)&&typeof this.a=="number"&&!isNaN(this.a)}}const ms=D(),Hi=D(0,0,0);D(.5,.5,.5);D(1,0,0);D(1,.5,0);D(1,1,0);D(0,1,0);D(0,1,1);D(0,0,1);D(.5,0,1);D(1,0,1);class Xe{constructor(t){this.time=t==null?void 0:V+t,this.setTime=t}set(t=0){this.time=V+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!=null}active(){return V<this.time}elapsed(){return V>=this.time}get(){return this.isSet()?V-this.time:0}getPercent(){return this.isSet()?Wt(this.time-V,this.setTime,0):0}toString(){return this.isSet()?Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let A=h(),B=32,li=h(1920,1080),te=h(),Di="arial",ys=!1,xs=!0;h(16);let Mt=0,vs=1,bs=1,ws=1,Ss=0,qs=.8,Ht=1,hi=0,Ts=!0,Cs=!0,Ps=!1,Is=.3;h(640,80);function Ms(i){A=i}function Ei(i){B=i}function Hs(i){te=i}class Ds{constructor(t=h(),e=h(1),s,n=0,r=new v,o=0){y(N(t)&&N(e),"ensure pos and size are vec2s"),y(typeof s!="number"||!s,"old style tile setup"),this.pos=t.copy(),this.size=e,this.drawSize=void 0,this.tileInfo=s,this.angle=n,this.color=r,this.additiveColor=void 0,this.mirror=!1,this.mass=vs,this.damping=bs,this.angleDamping=ws,this.elasticity=Ss,this.friction=qs,this.gravityScale=1,this.renderOrder=o,this.velocity=h(),this.angleVelocity=0,this.spawnTime=V,this.children=[],this.clampSpeedLinear=!0,this.parent=void 0,this.localPos=h(),this.localAngle=0,this.collideTiles=!1,this.collideSolidObjects=!1,this.isSolid=!1,this.collideRaycast=!1,et.push(this)}updateTransforms(){const t=this.parent;if(t){const e=t.getMirrorSign();this.pos=this.localPos.multiply(h(e,1)).rotate(-t.angle).add(t.pos),this.angle=e*this.localAngle+t.angle}for(const e of this.children)e.updateTransforms()}update(){if(this.parent)return;if(this.clampSpeedLinear)this.velocity.x=M(this.velocity.x,-1,Ht),this.velocity.y=M(this.velocity.y,-1,Ht);else{const s=this.velocity.lengthSquared();if(s>Ht*Ht){const n=Ht/s**.5;this.velocity.x*=n,this.velocity.y*=n}}const t=this.pos.copy();if(this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.y+=hi*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,y(this.angleDamping>=0&&this.angleDamping<=1),y(this.damping>=0&&this.damping<=1),!this.mass)return;const e=this.velocity.y<0;if(this.groundObject){const s=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=s+(this.velocity.x-s)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(const n of ki){if(!this.isSolid&&!n.isSolid||n.destroyed||n.parent||n==this||!Ee(this.pos,this.size,n.pos,n.size))continue;const r=this.collideWithObject(n),o=n.collideWithObject(this);if(!r||!o)continue;if(Ee(t,this.size,n.pos,n.size)){const m=t.subtract(n.pos),x=m.length(),S=.001,P=x<.01?ps(S):m.scale(S/x);this.velocity=this.velocity.add(P),n.mass&&(n.velocity=n.velocity.subtract(P)),ht&&ut&&ci(this.pos,this.size,n.pos,n.size,"#f00");continue}const a=this.size.add(n.size),c=(t.y-n.pos.y)*2>a.y+hi,l=ct(t.y-n.pos.y)*2<a.y,d=ct(t.x-n.pos.x)*2<a.x,p=xt(this.elasticity,n.elasticity);if(c||d||!l){if(this.pos.y=n.pos.y+(a.y/2+.001)*Nt(t.y-n.pos.y),n.groundObject&&e||!n.mass)e&&(this.groundObject=n),this.velocity.y*=-p;else if(n.mass){const m=(this.mass*this.velocity.y+n.mass*n.velocity.y)/(this.mass+n.mass),x=this.velocity.y*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.y*2*n.mass/(this.mass+n.mass),S=n.velocity.y*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.y*2*this.mass/(this.mass+n.mass);this.velocity.y=Et(p,m,x),n.velocity.y=Et(p,m,S)}}if(!c&&l)if(this.pos.x=n.pos.x+(a.x/2+.001)*Nt(t.x-n.pos.x),n.mass){const m=(this.mass*this.velocity.x+n.mass*n.velocity.x)/(this.mass+n.mass),x=this.velocity.x*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.x*2*n.mass/(this.mass+n.mass),S=n.velocity.x*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.x*2*this.mass/(this.mass+n.mass);this.velocity.x=Et(p,m,x),n.velocity.x=Et(p,m,S)}else this.velocity.x*=-p;ht&&ut&&ci(this.pos,this.size,n.pos,n.size,"#f0f")}if(this.collideTiles&&Gt(this.pos,this.size,this)&&!Gt(t,this.size,this)){const s=Gt(h(t.x,this.pos.y),this.size,this),n=Gt(h(this.pos.x,t.y),this.size,this);(s||!n)&&(this.velocity.y*=-this.elasticity,(this.groundObject=e)?this.pos.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4:this.pos.y=t.y),n&&(this.pos.x=t.x,this.velocity.x*=-this.elasticity),ht&&ut&&$t(this.pos,this.size,"#f00")}}render(){me(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}localToWorld(t){return this.pos.add(t.rotate(-this.angle))}worldToLocal(t){return t.subtract(this.pos).rotate(this.angle)}localToWorldVector(t){return t.rotate(this.angle)}worldToLocalVector(t){return t.rotate(-this.angle)}collideWithTile(t,e){return t>0}collideWithObject(t){return!0}getAliveTime(){return V-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=h(),s=0){y(!t.parent&&!this.children.includes(t)),this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=s}removeChild(t){y(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=!0,e=!0,s=!0,n=!0){y(t||!e,"solid objects must be set to collide"),this.collideSolidObjects=t,this.isSolid=e,this.collideTiles=s,this.collideRaycast=n}toString(){{let t="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(t+=`
pos = `+this.pos),(this.velocity.x||this.velocity.y)&&(t+=`
velocity = `+this.velocity),(this.size.x||this.size.y)&&(t+=`
size = `+this.size),this.angle&&(t+=`
angle = `+this.angle.toFixed(3)),this.color&&(t+=`
color = `+this.color),t}}renderDebugInfo(){{const t=h(xt(this.size.x,.2),xt(this.size.y,.2)),e=D(this.collideTiles?1:0,this.collideSolidObjects?1:0,this.isSolid?1:0,this.parent?.2:.5),s=this.parent?D(1,1,1,.5):D(0,0,0,.8);kt(this.pos,t,e,this.angle,!1),kt(this.pos,t.scale(.8),s,this.angle,!1),this.parent&&pt(this.pos,this.parent.pos,.1,D(0,0,1,.5),!1)}}}let T,F,Z,g,st=h(),se=[],ne;class ui{constructor(t){this.image=t,this.size=h(t.width,t.height),this.glTexture=Ys(t)}}function Es(i){return new R((i.x-st.x/2+.5)/B+A.x,(i.y-st.y/2+.5)/-B+A.y)}function Je(i){return new R((i.x-A.x)*B+st.x/2-.5,(i.y-A.y)*-B+st.y/2-.5)}function Rs(){return st.scale(1/B)}function me(i,t=h(1),e,s=new v,n=0,r,o=new v(0,0,0,0),a=xs,c,l){y(!0,"context only supported in canvas 2D mode"),y(typeof e!="number"||!e,"this is an old style calls, to fix replace it with tile(tileIndex, tileSize)");const d=e&&e.getTextureInfo();if(a)if(d){const p=h(1).divide(d.size),m=e.pos.x*p.x,x=e.pos.y*p.y,S=e.size.x*p.x,P=e.size.y*p.y,q=p.scale(Mt);Gs(d.glTexture),fi(i.x,i.y,r?-t.x:t.x,t.y,n,m+q.x,x+q.y,m-q.x+S,x-q.y+P,s.rgbaInt(),o.rgbaInt())}else fi(i.x,i.y,t.x,t.y,n,0,0,0,0,0,s.rgbaInt());else zt&&++ne,t=h(t.x,-t.y),As(i,t,n,r,p=>{if(d){const m=e.pos.x+Mt,x=e.pos.y+Mt,S=e.size.x-2*Mt,P=e.size.y-2*Mt;p.globalAlpha=s.a,p.drawImage(d.image,m,x,S,P,-.5,-.5,1,1),p.globalAlpha=1}else p.fillStyle=s,p.fillRect(-.5,-.5,1,1)},c,l)}function kt(i,t,e,s,n,r,o){me(i,t,void 0,e,s,!1,void 0,n,r,o)}function pt(i,t,e=.1,s,n,r,o){const a=h((t.x-i.x)/2,(t.y-i.y)/2),c=h(e,a.length()*2);kt(i.add(a),c,s,a.angle(),n,r,o)}function Os(i,t=new v,e=0,s=new v(0,0,0),n,r=F){r.fillStyle=t.toString(),r.beginPath();for(const o of i.map(Je))r.lineTo(o.x,o.y);r.closePath(),r.fill(),e&&(r.strokeStyle=s.toString(),r.lineWidth=e*B,r.stroke())}function As(i,t,e,s,n,r,o=F){i=Je(i),t=t.scale(B),o.save(),o.translate(i.x+.5,i.y+.5),o.rotate(e),o.scale(s?-t.x:t.x,-t.y),n(o),o.restore()}function Ri(i,t,e=1,s=new v,n=0,r=new v(0,0,0),o="center",a=Di,c=g,l=void 0){c.fillStyle=s.toString(),c.lineWidth=n,c.strokeStyle=r.toString(),c.textAlign=o,c.font=e+"px "+a,c.textBaseline="middle",c.lineJoin="round",t=t.copy(),(i+"").split(`
`).forEach(d=>{n&&c.strokeText(d,t.x,t.y,l),c.fillText(d,t.x,t.y,l),t.y+=e})}function Q(i,t=0){return y(t>0||typeof i!="number"||i<3,"use code string for keyboard"),H[t]&&!!(H[t][i]&1)}function K(i,t=0){return y(t>0||typeof i!="number"||i<3,"use code string for keyboard"),H[t]&&!!(H[t][i]&2)}function Us(i,t=0){return y(t>0||typeof i!="number"||i<3,"use code string for keyboard"),H[t]&&!!(H[t][i]&4)}function Oi(){H=[[]]}const Ai=Q,Pt=K,Bs=Us;let O=h(),bt=h(),re=0,oe=!1;function Dt(i,t=0){return Q(i,t+1)}let H=[[]];function _s(){!Lt&&!document.hasFocus()&&Oi(),O=Es(bt),zs()}function Ls(){for(const i of H)for(const t in i)i[t]&=1;re=0}function Fs(){onkeydown=t=>{t.repeat||(oe=!1,H[0][t.code]=3,H[0][i(t.code)]=3)},onkeyup=t=>{H[0][t.code]=4,H[0][i(t.code)]=4};function i(t){return t=="KeyW"?"ArrowUp":t=="KeyS"?"ArrowDown":t=="KeyA"?"ArrowLeft":t=="KeyD"?"ArrowRight":t}onmousedown=t=>{dt&&dt.state!="running"&&dt.resume(),oe=!1,H[0][t.button]=3,bt=Re(t),t.button&&t.preventDefault()},onmouseup=t=>H[0][t.button]=H[0][t.button]&2|4,onmousemove=t=>bt=Re(t),onwheel=t=>re=t.ctrlKey?0:Nt(t.deltaY),oncontextmenu=t=>!1,onblur=t=>Oi(),Lt&&Cs&&Ns()}function Re(i){if(!T||ys)return h();const t=T.getBoundingClientRect();return h(T.width,T.height).multiply(h(Wt(i.x,t.left,t.right),Wt(i.y,t.top,t.bottom)))}const Oe=[];function zs(){const i=e=>{const r=o=>o>.3?Wt(o,.3,.8):o<-.3?-Wt(-o,.3,.8):0;return h(r(e.x),r(-e.y)).clampLength()};if(!navigator||!navigator.getGamepads)return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=H[e+1]||(H[e+1]=[]),r=Oe[e]||(Oe[e]=[]);if(s){for(let o=0;o<s.axes.length-1;o+=2)r[o>>1]=i(h(s.axes[o],s.axes[o+1]));for(let o=s.buttons.length;o--;){const a=s.buttons[o],c=Dt(o,e);n[o]=a.pressed?c?1:3:c?4:0,oe||(oe=!e&&a.pressed)}{const o=h((Dt(15,e)&&1)-(Dt(14,e)&&1),(Dt(12,e)&&1)-(Dt(13,e)&&1));o.lengthSquared()&&(r[0]=o.clampLength())}}}}const Lt=window.ontouchstart!==void 0;function Ns(){let i=e;document.addEventListener("touchstart",s=>i(s),{passive:!1}),document.addEventListener("touchmove",s=>i(s),{passive:!1}),document.addEventListener("touchend",s=>i(s),{passive:!1}),onmousedown=onmouseup=()=>0;let t;function e(s){dt&&dt.state!="running"&&dt.resume();const n=s.touches.length,r=0;if(n){const o=h(s.touches[0].clientX,s.touches[0].clientY);bt=Re(o),t?oe=Ps:H[0][r]=3}else t&&(H[0][r]=H[0][r]&2|4);return t=n,document.hasFocus()&&s.preventDefault(),!0}}let dt=new AudioContext,Se;function Ws(){Se=dt.createGain(),Se.connect(dt.destination),Se.gain.value=Is}let Ui=[],vt=h();function Bi(i){return i.arrayCheck(vt)?Ui[(i.y|0)*vt.x+i.x|0]:0}function Gt(i,t=h(),e){const s=xt(i.x-t.x/2|0,0),n=xt(i.y-t.y/2|0,0),r=yt(i.x+t.x/2,vt.x),o=yt(i.y+t.y/2,vt.y);for(let a=n;a<o;++a)for(let c=s;c<r;++c){const l=Ui[a*vt.x+c];if(l&&(!e||e.collideWithTile(l,h(c,a))))return!0}return!1}function ks(i,t,e){const s=t.subtract(i),n=s.length(),r=s.normalize(),o=h(ct(1/r.x),ct(1/r.y));let c=i.floor(),l=o.x*(s.x<0?i.x-c.x:c.x-i.x+1),d=o.y*(s.y<0?i.y-c.y:c.y-i.y+1);for(;;){if(Bi(c))return mt&&He(i,t,"#f00",.02),mt&&Ii(c.add(h(.5)),"#ff0"),c.add(h(.5));if(l>n&&d>n)break;l>d?(c.y+=Nt(s.y),d+=o.y):(c.x+=Nt(s.x),l+=o.x)}mt&&He(i,t,"#00f",.02)}let tt,w,Vs=!0,ee,Ae,_i,Ue,G,Be,at,Ze,ae;function $s(){tt=document.createElement("canvas"),w=tt.getContext("webgl2",{antialias:Vs}),T.parentElement.appendChild(tt),ee=Ks(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`);const t=new ArrayBuffer(Ni);G=new Float32Array(t),Be=new Uint32Array(t),_i=w.createBuffer(),Ue=w.createBuffer();const e=new Float32Array([at=0,0,1,0,0,1,1,1]);w.bindBuffer(St,Ue),w.bufferData(St,e,on)}function js(){w.viewport(0,0,tt.width=T.width,tt.height=T.height),w.clear(nn),w.useProgram(ee),w.activeTexture(rn),se[0]&&w.bindTexture(gt,Ae=se[0].glTexture);let i=Ze=ae=0,t=(n,r,o,a)=>{const c=w.getAttribLocation(ee,n),l=o&&zi,d=o&&1,p=o==1;w.enableVertexAttribArray(c),w.vertexAttribPointer(c,a,r,p,l,i),w.vertexAttribDivisor(c,d),i+=a*o};w.bindBuffer(St,Ue),t("g",Kt,0,2),w.bindBuffer(St,_i),w.bufferData(St,Ni,an),t("p",Kt,4,4),t("u",Kt,4,4),t("c",ce,1,4),t("a",ce,1,4),t("r",Kt,4,1);const e=h(2*B).divide(st),s=h(-1).subtract(A.multiply(e));w.uniformMatrix4fv(w.getUniformLocation(ee,"m"),!1,[e.x,0,0,0,0,e.y,0,0,1,1,1,1,s.x,s.y,0,0])}function Gs(i){i!=Ae&&(Qe(),w.bindTexture(gt,Ae=i))}function di(i,t){const e=w.createShader(t);if(w.shaderSource(e,i),w.compileShader(e),!w.getShaderParameter(e,hn))throw w.getShaderInfoLog(e);return e}function Ks(i,t){const e=w.createProgram();if(w.attachShader(e,di(i,ln)),w.attachShader(e,di(t,cn)),w.linkProgram(e),!w.getProgramParameter(e,un))throw w.getProgramInfoLog(e);return e}function Ys(i){const t=w.createTexture();if(w.bindTexture(gt,t),i&&i.width)w.texImage2D(gt,0,Yt,Yt,ce,i);else{const s=new Uint8Array([255,255,255,255]);w.texImage2D(gt,0,Yt,1,1,0,Yt,ce,s)}const e=tn;return w.texParameteri(gt,sn,e),w.texParameteri(gt,en,e),t}function Qe(){if(!at)return;const i=ae?gi:Zs;w.blendFuncSeparate(Js,i,gi,i),w.enable(Qs),w.bufferSubData(St,0,G),w.drawArraysInstanced(Xs,0,4,at),zt&&(ne+=at),at=0,ae=Ze}function _e(i,t=!1){!at&&!t||(Qe(),t&&i.drawImage(tt,0,0))}function fi(i,t,e,s,n,r,o,a,c,l,d=0){y(typeof l=="number"&&typeof d=="number","invalid color"),(at>=Fi||ae!=Ze)&&Qe();let p=at*Li;G[p++]=i,G[p++]=t,G[p++]=e,G[p++]=s,G[p++]=r,G[p++]=o,G[p++]=a,G[p++]=c,Be[p++]=l,Be[p++]=d,G[p++]=n,at++}const gi=1,Xs=5,Js=770,Zs=771,Qs=3042,gt=3553,ce=5121,Kt=5126,Yt=6408,tn=9728,en=10240,sn=10241,nn=16384,rn=33984,St=34962,on=35044,an=35048,cn=35632,ln=35633,hn=35713,un=35714,Li=11,Fi=1e4,zi=Li*4,Ni=Fi*zi,Wi="LittleJS",dn="1.10.7",pi=60;let et=[],ki=[],fn=0,V=0,mi=0,J=0,qe=0;const Le=[],Fe=[];function gn(i,t){y(!Le.includes(i)),y(!Fe.includes(t)),i&&Le.push(i),t&&Fe.push(t)}function pn(i,t,e,s,n,r=[],o=document.body){y(Array.isArray(r),"pass in images as array");function a(){st=h(T.width,T.height),F.imageSmoothingEnabled=!1,js()}function c(S=0){let P=S-mi;mi=S,qe=Et(.05,qe,1e3/(P||1));const q=Q("Equal"),E=Q("Minus");P*=q?5:E?.2:1,J+=P,q||(J=yt(J,50)),l();{let I=0;for(J<0&&J>-9&&(I=J,J=0);J>=0;J-=1e3/pi)V=fn++/pi,_s(),t(),Le.forEach($=>$()),mn(),us(),Ls();J+=I}{a(),s(),et.sort((I,$)=>I.renderOrder-$.renderOrder);for(const I of et)I.destroyed||I.render();if(n(),Fe.forEach(I=>I()),ds(),_e(F),zt){g.textAlign="right",g.textBaseline="top",g.font="1em monospace",g.fillStyle="#000";const I=Wi+" v"+dn+" / "+ne+" / "+et.length+" / "+qe.toFixed(1)+" GL";g.fillText(I,T.width-3,3),g.fillStyle="#fff",g.fillText(I,T.width-2,2),ne=0}}requestAnimationFrame(c)}function l(){if(te.x){T.width=te.x,T.height=te.y;const S=innerWidth/innerHeight,P=T.width/T.height;(tt||T).style.width=T.style.width=Z.style.width=S<P?"100%":"",(tt||T).style.height=T.style.height=Z.style.height=S<P?"":"100%"}else T.width=yt(innerWidth,li.x),T.height=yt(innerHeight,li.y);Z.width=T.width,Z.height=T.height,st=h(T.width,T.height)}function d(){new Promise(S=>S(i())).then(c)}const p="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none";o.style.cssText=p,o.appendChild(T=document.createElement("canvas")),F=T.getContext("2d"),Fs(),Ws(),hs(),$s(),o.appendChild(Z=document.createElement("canvas")),g=Z.getContext("2d");const m="position:absolute";T.style.cssText=Z.style.cssText=m,tt&&(tt.style.cssText=m),l();const x=r.map((S,P)=>new Promise(q=>{const E=new Image;E.onerror=E.onload=()=>{se[P]=new ui(E),q()},E.src=S}));r.length||x.push(new Promise(S=>{se[0]=new ui(new Image),S()})),Promise.all(x).then(d)}function mn(){ki=et.filter(t=>t.collideSolidObjects);function i(t){if(!t.destroyed){t.update();for(const e of t.children)i(e)}}for(const t of et)t.parent||(i(t),t.updateTransforms());et=et.filter(t=>!t.destroyed)}let ti=ms,ei=Hi,yn=Hi,xn=Mi(0,0,.5),vn=Mi(0,0,.7),ii=4,Vi="arial",ze=[],rt;function bn(i=g){rt=i,gn(t,e);function t(){function s(n){if(n.visible){n.parent&&(n.pos=n.localPos.add(n.parent.pos)),n.update();for(const r of n.children)s(r)}}ze.forEach(n=>n.parent||s(n))}function e(){function s(n){if(n.visible){n.parent&&(n.pos=n.localPos.add(n.parent.pos)),n.render();for(const r of n.children)s(r)}}ze.forEach(n=>n.parent||s(n))}}function $i(i,t,e=ti,s=ii,n=ei){rt.fillStyle=e.toString(),rt.beginPath(),rt.rect(i.x-t.x/2,i.y-t.y/2,t.x,t.y),rt.fill(),s&&(rt.strokeStyle=n.toString(),rt.lineWidth=s,rt.stroke())}function ji(i,t,e,s=ti,n=ii,r=ei,o="center",a=Vi){Ri(i,t,e.y,s,n,r,o,a,rt,e.x)}class W{constructor(t=h(),e=h()){this.localPos=t.copy(),this.pos=t.copy(),this.size=e.copy(),this.color=ti,this.lineColor=ei,this.textColor=yn,this.hoverColor=vn,this.lineWidth=ii,this.font=Vi,this.visible=!0,this.children=[],this.parent=null,ze.push(this)}addChild(t){y(!t.parent&&!this.children.includes(t)),this.children.push(t),t.parent=this}removeChild(t){y(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}update(){const t=this.mouseIsOver,e=Ai(0);(!e||Lt)&&(this.mouseIsOver=Ee(this.pos,this.size,bt),!e&&Lt&&(this.mouseIsOver=!1),this.mouseIsOver&&!t&&this.onEnter(),!this.mouseIsOver&&t&&this.onLeave()),Pt(0)&&this.mouseIsOver?(this.mouseIsHeld=!0,this.onPress(),Lt&&(this.mouseIsOver=!1)):this.mouseIsHeld&&!e&&(this.mouseIsHeld=!1,this.onRelease())}render(){this.size.x&&this.size.y&&$i(this.pos,this.size,this.color,this.lineWidth,this.lineColor)}onEnter(){}onLeave(){}onPress(){}onRelease(){}onChange(){}}class nt extends W{constructor(t,e,s="",n="center",r=Di){super(t,e),this.text=s,this.align=n,this.font=r,this.lineWidth=0}render(){ji(this.text,this.pos,this.size,this.textColor,this.lineWidth,this.lineColor,this.align,this.font)}}class Xt extends W{constructor(t,e,s){super(t,e),this.text=s,this.color=xn}render(){const t=this.mouseIsHeld?this.color:this.lineColor,e=this.mouseIsOver?this.hoverColor:this.color;$i(this.pos,this.size,e,this.lineWidth,t);const s=h(this.size.x,this.size.y*.8);ji(this.text,this.pos,s,this.textColor,0,void 0,this.align,this.font)}}const f={type:"Clear",movementCost:1,hoverMovementCost:1,directFireModifier:0,indirectFireModifier:2},_={type:"Roads & Bridges",movementCost:.5,hoverMovementCost:.5,directFireModifier:0,indirectFireModifier:2,specialRules:["Road movement ignores terrain of underlying hex"]},wn={type:"Hilltop",movementCost:2,hoverMovementCost:2,directFireModifier:2,indirectFireModifier:4},Te={type:"City",movementCost:.5,hoverMovementCost:1,directFireModifier:6,indirectFireModifier:8},L={type:"Lake",movementCost:1/0,hoverMovementCost:1,directFireModifier:0,indirectFireModifier:2,specialRules:["Hover units only"]},b={type:"Forest",movementCost:2,hoverMovementCost:2,directFireModifier:2,indirectFireModifier:4},Sn={Clear:"#90EE90","Roads & Bridges":"#FF0000",Slope:"#D2B48C",Hilltop:"#8B4513",City:"#000000",River:"#ADD8E6",Lake:"#0000FF",Forest:"#006400",Swamp:"#90EE90",Rubble:"#808080",Fortress:"#696969"},qn={Clear:{firing:0,intervening:0,target:0},"Roads & Bridges":{firing:0,intervening:0,target:0},River:{firing:0,intervening:0,target:0},Rubble:{firing:0,intervening:0,target:0},Fortress:{firing:0,intervening:0,target:0},Swamp:{firing:0,intervening:0,target:0},Lake:{firing:0,intervening:0,target:0},Forest:{firing:0,intervening:2,target:0},City:{firing:0,intervening:2,target:0},Slope:{firing:1,intervening:1,target:1},Hilltop:{firing:2,intervening:3,target:2}},qt=new WeakMap,ie=new WeakMap,le={current:[]};let Ce=!1;const Jt=new Set,yi=new Map;function Gi(i){const t=Array.from(i).sort((e,s)=>e instanceof Tt&&e.options.deps.includes(s)?1:s instanceof Tt&&s.options.deps.includes(e)?-1:0);for(const e of t){if(le.current.includes(e))continue;le.current.push(e),e.recompute();const s=ie.get(e);if(s)for(const n of s){const r=qt.get(n);r&&Gi(r)}}}function Tn(i){i.listeners.forEach(t=>t({prevVal:i.prevState,currentVal:i.state}))}function Cn(i){i.listeners.forEach(t=>t({prevVal:i.prevState,currentVal:i.state}))}function Pn(i){if(Jt.add(i),!Ce)try{for(Ce=!0;Jt.size>0;){const t=Array.from(Jt);Jt.clear();for(const e of t){const s=yi.get(e)??e.prevState;e.prevState=s,Tn(e)}for(const e of t){const s=qt.get(e);s&&(le.current.push(e),Gi(s))}for(const e of t){const s=qt.get(e);if(s)for(const n of s)Cn(n)}}}finally{Ce=!1,le.current=[],yi.clear()}}class Ne{constructor(t,e){this.listeners=new Set,this.subscribe=s=>{var n,r;this.listeners.add(s);const o=(r=(n=this.options)==null?void 0:n.onSubscribe)==null?void 0:r.call(n,s,this);return()=>{this.listeners.delete(s),o==null||o()}},this.setState=s=>{var n,r,o;this.prevState=this.state,this.state=(n=this.options)!=null&&n.updateFn?this.options.updateFn(this.prevState)(s):s(this.prevState),(o=(r=this.options)==null?void 0:r.onUpdate)==null||o.call(r),Pn(this)},this.prevState=t,this.state=t,this.options=e}}class Tt{constructor(t){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const e=[],s=[];for(const n of this.options.deps)e.push(n.prevState),s.push(n.state);return this.lastSeenDepValues=s,{prevDepVals:e,currDepVals:s,prevVal:this.prevState??void 0}},this.recompute=()=>{var e,s;this.prevState=this.state;const{prevDepVals:n,currDepVals:r,prevVal:o}=this.getDepVals();this.state=this.options.fn({prevDepVals:n,currDepVals:r,prevVal:o}),(s=(e=this.options).onUpdate)==null||s.call(e)},this.checkIfRecalculationNeededDeeply=()=>{for(const r of this.options.deps)r instanceof Tt&&r.checkIfRecalculationNeededDeeply();let e=!1;const s=this.lastSeenDepValues,{currDepVals:n}=this.getDepVals();for(let r=0;r<n.length;r++)if(n[r]!==s[r]){e=!0;break}e&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const e of this._subscriptions)e()}),this.subscribe=e=>{var s,n;this.listeners.add(e);const r=(n=(s=this.options).onSubscribe)==null?void 0:n.call(s,e,this);return()=>{this.listeners.delete(e),r==null||r()}},this.options=t,this.state=t.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(t=this.options.deps){for(const e of t)if(e instanceof Tt)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof Ne){let s=qt.get(e);s||(s=new Set,qt.set(e,s)),s.add(this);let n=ie.get(this);n||(n=new Set,ie.set(this,n)),n.add(e)}}unregisterFromGraph(t=this.options.deps){for(const e of t)if(e instanceof Tt)this.unregisterFromGraph(e.options.deps);else if(e instanceof Ne){const s=qt.get(e);s&&s.delete(this);const n=ie.get(this);n&&n.delete(e)}}}const it=i=>Number.isFinite(i)&&!Number.isNaN(i),he=i=>typeof i=="object"&&i!==null,In=i=>typeof i=="function",ue=i=>he(i)&&it(i.col)&&it(i.row),Mn=i=>he(i)&&it(i.x)&&it(i.y),We=i=>Array.isArray(i)&&it(i[0])&&it(i[1]),ye=(i,t)=>t+i*(t&1)>>1,ke=([i,t,e=-i-t])=>({q:i,r:t,s:e});function de({q:i,r:t,s:e}){const s=it(i),n=it(t),r=it(e);if(s&&n&&r)return{q:i,r:t,s:e};if(s&&n)return{q:i,r:t,s:-i-t};if(s&&r)return{q:i,r:-i-e,s:e};if(n&&r)return{q:-t-e,r:t,s:e};throw new TypeError(`Can't determine three cube coordinates from less than two coordinates. Received: { q: ${i}, r: ${t}, s: ${e} }.`)}var Y=(i=>(i.FLAT="FLAT",i.POINTY="POINTY",i))(Y||{});function Hn(i,t){if(he(i)&&i.xRadius>0&&i.yRadius>0)return i;if(he(i)&&i.width>0&&i.height>0){const{width:e,height:s}=i;return t===Y.POINTY?{xRadius:e/Math.sqrt(3),yRadius:s/2}:{xRadius:e/2,yRadius:s/Math.sqrt(3)}}if(i>0)return{xRadius:i,yRadius:i};throw new TypeError(`Invalid dimensions: ${JSON.stringify(i)}. Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number.`)}function Dn(i,t){if(Mn(i))return i;if(!t)throw new TypeError(`Supply a bounding box ({ width: number, height: number }). Received: ${JSON.stringify(t)}`);if(i==="topLeft")return{x:t.width*-.5,y:t.height*-.5};throw new TypeError(`Invalid origin: ${JSON.stringify(i)}. Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'.`)}class si{constructor(t=[0,0]){ve(this,"q");ve(this,"r");const{q:e,r:s}=fe(this,t);this.q=e,this.r=s}static get settings(){const{dimensions:t,orientation:e,origin:s,offset:n}=this.prototype;return{dimensions:t,orientation:e,origin:s,offset:n}}get center(){const{width:t,height:e,x:s,y:n}=this;return{x:t/2-s,y:e/2-n}}get col(){return xi(this).col}get corners(){const{orientation:t,width:e,height:s,x:n,y:r}=this;return t===Y.POINTY?En(e,s,n,r):Rn(e,s,n,r)}get dimensions(){return Ot.dimensions}get height(){const{orientation:t,dimensions:{yRadius:e}}=this;return t===Y.POINTY?e*2:e*Math.sqrt(3)}get isFlat(){return this.orientation===Y.FLAT}get isPointy(){return this.orientation===Y.POINTY}get orientation(){return Ot.orientation}get origin(){return Ot.origin}get offset(){return Ot.offset}get row(){return xi(this).row}get width(){const{orientation:t,dimensions:{xRadius:e}}=this;return t===Y.POINTY?e*Math.sqrt(3):e*2}get x(){return vi(this).x}get y(){return vi(this).y}get s(){return-this.q-this.r}clone(t=this){return new this.constructor(t)}equals(t){return On(this,ue(t)?Ji(this,t):t)}toString(){return`${this.constructor.name}(${this.q},${this.r})`}translate(t){return _n(this,t)}}const Ot={dimensions:{xRadius:1,yRadius:1},orientation:Y.POINTY,origin:{x:0,y:0},offset:-1},En=(i,t,e,s)=>[{x:e+i*.5,y:s-t*.25},{x:e+i*.5,y:s+t*.25},{x:e,y:s+t*.5},{x:e-i*.5,y:s+t*.25},{x:e-i*.5,y:s-t*.25},{x:e,y:s-t*.5}],Rn=(i,t,e,s)=>[{x:e+i*.25,y:s-t*.5},{x:e+i*.5,y:s},{x:e+i*.25,y:s+t*.5},{x:e-i*.25,y:s+t*.5},{x:e-i*.5,y:s},{x:e-i*.25,y:s-t*.5}];function Ki(i){const{dimensions:t,orientation:e,origin:s,offset:n}={...Ot,...i};return class extends si{get dimensions(){return Hn(t,e)}get orientation(){return e}get origin(){return Dn(s,this)}get offset(){return n}}}function On(i,t){if(ue(i)&&ue(t))return i.col===t.col&&i.row===t.row;if(Object.hasOwn(i,"col")||Object.hasOwn(t,"col"))throw new Error(`Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ${JSON.stringify(i)} and ${JSON.stringify(t)}`);const e=We(i)?ke(i):i,s=We(t)?ke(t):t;return e.q===s.q&&e.r===s.r}const An=(i,t,e)=>({col:i+ye(e,t),row:t}),Un=(i,t,e)=>({col:i,row:t+ye(e,i)}),xi=({q:i,r:t,offset:e,isPointy:s})=>s?An(i,t,e):Un(i,t,e),vi=({orientation:i,dimensions:{xRadius:t,yRadius:e},origin:{x:s,y:n},q:r,r:o})=>i===Y.POINTY?{x:t*Math.sqrt(3)*(r+o/2)-s,y:e*3/2*o-n}:{x:t*3/2*r-s,y:e*Math.sqrt(3)*(o+r/2)-n},Yi=(i,t,e)=>{const s=i-ye(e,t),n=t,r=-s-n;return{q:s,r:n,s:r}},Xi=(i,t,e)=>{const s=i,n=t-ye(e,i),r=-s-n;return{q:s,r:n,s:r}},Ji=({offset:i,orientation:t},{col:e,row:s})=>t===Y.POINTY?Yi(e,s,i):Xi(e,s,i),bi=i=>{const{q:t,r:e,s}=de(i);let n=Math.round(t),r=Math.round(e),o=Math.round(s);const a=Math.abs(t-n),c=Math.abs(e-r),l=Math.abs(s-o);return a>c&&a>l?n=-r-o:c>l?r=-n-o:o=-n-r,{q:n,r,s:o}},Bn=({dimensions:{xRadius:i,yRadius:t},origin:e,orientation:s},{x:n,y:r})=>(n+=e.x,r+=e.y,s===Y.POINTY?bi({q:Math.sqrt(3)*n/(3*i)-r/(3*t),r:2/3*(r/t)}):bi({q:2/3*(n/i),r:Math.sqrt(3)*r/(3*t)-n/(3*i)}));function fe(i,t){return We(t)?ke(t):ue(t)?Ji(i,t):de(t)}function _n(i,t){const{q:e,r:s,s:n}=de(i),{q:r,r:o,s:a}=de(t),c={q:e+r,r:s+o,s:n+a};return i instanceof si?i.clone(c):c}function Ve(i,t,e){const{q:s,r:n,s:r}=fe(i,t),{q:o,r:a,s:c}=fe(i,e);return Math.max(Math.abs(s-o),Math.abs(n-a),Math.abs(r-c))}var $e=(i=>(i.CLOCKWISE="CLOCKWISE",i.COUNTERCLOCKWISE="COUNTERCLOCKWISE",i))($e||{}),X=(i=>(i[i.N=0]="N",i[i.NE=1]="NE",i[i.E=2]="E",i[i.SE=3]="SE",i[i.S=4]="S",i[i.SW=5]="SW",i[i.W=6]="W",i[i.NW=7]="NW",i))(X||{});const Ln=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],Fn=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],zn=({offset:i,q:t,r:e,col:s,row:n},r)=>{if(r===X.S||r===X.N){const a=r===X.S?n+1:n-1;return Yi(s,a,i)}const o=Ln[r];return{q:t+o.q,r:e+o.r}},Nn=({offset:i,q:t,r:e,col:s,row:n},r)=>{if(r===X.E||r===X.W){const a=r===X.E?s+1:s-1;return Xi(a,n,i)}const o=Fn[r];return{q:t+o.q,r:e+o.r}},Wn=(i,t)=>i.clone(i.isPointy?zn(i,t):Nn(i,t));function kn(i){return Array.isArray(i)?function(t,e){const s=[];let n=e;for(const r of i)for(const o of r(t,n))s.push(n=o);return s}:i}X.E,X.N,X.S,X.W;function Zi(i){const{center:t,rotation:e=$e.CLOCKWISE}=i;return function(s,n){const r=e.toUpperCase(),o=[];let{radius:a}=i;const c=it(a);let l;c?l=s(t).translate({q:a,s:-a}):(l=s(i.start??n),a=Ve(l,t,l));const{q:d,r:p,s:m}=fe(l,t);let x=s({q:d,r:p-a,s:m+a});if(r===$e.CLOCKWISE)for(let q=0;q<6;q++)for(let E=0;E<a;E++){const{q:I,r:$}=wi[q];x=s({q:x.q+I,r:x.r+$}),o.push(x)}else for(let q=5;q>=0;q--)for(let E=0;E<a;E++){const{q:I,r:$}=wi[q];x=s({q:x.q-I,r:x.r-$}),o.push(x)}const S=c?!1:!i.start&&n,P=o.findIndex(q=>q.equals(l));return o.slice(P+(S?1:0)).concat(o.slice(0,P))}}const wi=[{q:1,r:0},{q:0,r:1},{q:-1,r:1},{q:-1,r:0},{q:0,r:-1},{q:1,r:-1}];var k,lt,U,At,Ge,Ke,Ye;const ot=class ot{constructor(t,e=[]){jt(this,U);jt(this,k);jt(this,lt,new Map);if(t instanceof ot){we(this,k,z(t,k)),this.setHexes(t);return}we(this,k,t),this.setHexes(j(this,U,Ge).call(this,e))}static fromIterable(t){const e=t[Symbol.iterator]().next().value;if(!e)throw new TypeError(`Can't create grid from empty iterable: ${JSON.stringify(t)}`);return new ot(e.constructor,t)}static fromJSON({hexSettings:t,coordinates:e},s){if(s){const r=e.map(s),o=r.length>0?r[0].constructor:s({q:0,r:0},0,[{q:0,r:0}]).constructor;return new ot(o,r)}const n=Ki(t);return new ot(n,e.map(r=>new n(r)))}get size(){return z(this,lt).size}get pixelWidth(){if(this.size===0)return 0;const{isPointy:t,width:e}=this.hexPrototype,s=this.toArray(),{0:n,length:r,[r-1]:o}=t?s.sort((a,c)=>c.s-a.s||a.q-c.q):s.sort((a,c)=>a.q-c.q);return o.x-n.x+e}get pixelHeight(){if(this.size===0)return 0;const{isPointy:t,height:e}=this.hexPrototype,s=this.toArray(),{0:n,length:r,[r-1]:o}=t?s.sort((a,c)=>a.r-c.r):s.sort((a,c)=>c.s-a.s||a.r-c.r);return o.y-n.y+e}[Symbol.iterator](){return z(this,lt).values()}get hexPrototype(){return z(this,k).prototype}createHex(t){return new(z(this,k))(t)}getHex(t){const e=this.createHex(t);return z(this,lt).get(e.toString())}hasHex(t){return z(this,lt).has(t.toString())}setHexes(t){for(const e of t){const s=e instanceof si?e:new(z(this,k))(e);j(this,U,At).call(this,s)}return this}filter(t){var s;const e=new ot(z(this,k));for(const n of this)t(n)&&j(s=e,U,At).call(s,n);return e}map(t){var s;const e=new ot(z(this,k));for(const n of this)j(s=e,U,At).call(s,t(n));return e}traverse(t,{bail:e=!1}={}){var n;const s=new ot(z(this,k));for(const r of j(this,U,Ge).call(this,t)){const o=this.getHex(r);if(o)j(n=s,U,At).call(n,o);else if(e)return s}return s}forEach(t){for(const e of this)t(e);return this}reduce(t,e){if(e===void 0){let n,r,o;for(const a of this)r=o,o=a,r&&(n=t(r,o));return n}let s=e;for(const n of this)s=t(s,n);return s}toArray(){return Array.from(this)}toJSON(){const{dimensions:t,orientation:e,origin:s,offset:n}=this.hexPrototype;return{hexSettings:{dimensions:t,orientation:e,origin:s,offset:n},coordinates:this.toArray()}}toString(){return`${this.constructor.name}(${this.size})`}pointToHex(t,{allowOutside:e=!0}={}){const s=Bn(this.hexPrototype,t),n=this.getHex(s);return e?n??this.createHex(s):n}distance(t,e,{allowOutside:s=!0}={}){if(s)return Ve(this.hexPrototype,t,e);const n=this.getHex(t),r=this.getHex(e);if(!(!n||!r))return Ve(this.hexPrototype,n,r)}neighborOf(t,e,{allowOutside:s=!0}={}){const n=Wn(this.createHex(t),e),r=this.getHex(n);return s?r??n:r}};k=new WeakMap,lt=new WeakMap,U=new WeakSet,At=function(t){z(this,lt).set(t.toString(),t)},Ge=function(t){return j(this,U,Ke).call(this,t)?j(this,U,Ye).call(this,t):Array.isArray(t)&&j(this,U,Ke).call(this,t[0])?j(this,U,Ye).call(this,kn(t)):t},Ke=function(t){return In(t)},Ye=function(t){return t(this.createHex.bind(this))};let je=ot;const Vn={type:"heavy_tank",rating:{firepower:4,range:2,defense:3,movement:3}},$n={type:"missile_tank",rating:{firepower:3,range:4,defense:2,movement:2}},jn={type:"light_tank",rating:{firepower:2,range:2,defense:2,movement:3}},Gn={type:"superheavy",rating:{firepower:6,range:3,defense:5,movement:3}},Kn={type:"howitzer",rating:{firepower:6,range:8,defense:1,movement:0}},Yn={type:"LAD",rating:{firepower:2,range:8,defense:1,movement:0}},Xn={type:"mobile_howitzer",rating:{firepower:6,range:6,defense:2,movement:1}},Jn={type:"GEV",rating:{firepower:2,range:2,defense:2,movement:7}},Zn={type:"light_GEV",rating:{firepower:1,range:2,defense:1,movement:7}},Qn={type:"GEV_carrier",rating:{firepower:1,range:2,defense:2,movement:5}},tr={type:"infantry",rating:{firepower:1,range:1,defense:1,movement:2}},er={type:"heavy_weapons_team",rating:{firepower:3,range:4,defense:1,movement:2}},ir={type:"engineers",rating:{firepower:2,range:1,defense:2,movement:2}};class sr extends Ds{constructor(t){super(t),this.size=h(1),this.dragging=!1,this.draggable=!1,this.dragOffset=h(),this.lastPos=t}snapToHex(t){this.dragging&&(this.pos=t)}update(){if(Pt(0)&&this.draggable===!0){const t=O.x>this.pos.x-this.size.x/2&&O.x<this.pos.x+this.size.x/2,e=O.y>this.pos.y-this.size.y/2&&O.y<this.pos.y+this.size.y/2;t&&e&&(this.lastPos=this.pos,this.dragging=!0,this.dragOffset=O.subtract(this.pos))}Ai(0)&&this.dragging&&(this.pos=O.subtract(this.dragOffset)),Bs(0)&&(this.dragging=!1)}}class ge extends Ki({dimensions:1}){constructor(){super(...arguments),this.visibility="undiscovered"}static create(t){const e=new ge(t);return e.terrain=t.terrain,e.cost=t.cost,e}}class nr extends sr{constructor(t,e,s){super(t),this.side=e,this.color=new v().setHex(this.side==="blue"?"#000000":"#FFFFFF"),this.type=s.type,this.firepower=s.rating.firepower,this.range=s.rating.range,this.movement=s.rating.movement,this.defense=s.rating.defense,this.remainingMovement=this.movement,this.selected=!1,this.hexCoords={q:0,r:0},this.hexCoordsDirty=!0,this.isMoving=!1,this.movementPath=[],this.currentPathIndex=0,this.moveStartTime=0,this.moveSpeed=.3,this.moveCompleteCallback=null}moveAnimated(t,e,s){if(e<=0||t.length===0){s(this.remainingMovement);return}this.isMoving=!0,this.movementPath=[...t],this.currentPathIndex=0,this.moveStartTime=V;const n=this.remainingMovement-e;this.remainingMovement=n,this.moveCompleteCallback=s}update(){super.update(),this.isMoving&&this.movementPath.length>0&&this.updateMovementAnimation()}updateMovementAnimation(){const e=V-this.moveStartTime,s=this.moveSpeed,n=Math.floor(e/s);if(n>=this.movementPath.length){this.completeMovement();return}const r=Math.min(n,this.movementPath.length-1),o=Math.min(r+1,this.movementPath.length-1),a=this.movementPath[r],c=this.movementPath[o],l=e%s/s;r!==o?this.pos=h(a).lerp(c,l):this.pos=a}completeMovement(){this.setPosition(this.movementPath[this.movementPath.length-1]),this.isMoving=!1,this.movementPath=[],this.currentPathIndex=0,this.moveCompleteCallback&&(this.moveCompleteCallback(this.remainingMovement),this.moveCompleteCallback=null)}getHexCoords(t){if(this.hexCoordsDirty){const e=t.pointToHex(this.pos);this.hexCoords={q:e.q,r:e.r},this.hexCoordsDirty=!1}return this.hexCoords}setPosition(t){this.pos=t,this.hexCoordsDirty=!0}canBeSelected(){return!this.isMoving&&this.remainingMovement>0}render(){if(super.render(),this.selected){const t=new v().setHex("#FFD700"),e=.08,s=.1,n=this.size.x/2+s,r=this.size.y/2+s,o=h(this.pos.x-n,this.pos.y+r),a=h(this.pos.x+n,this.pos.y+r),c=h(this.pos.x-n,this.pos.y-r),l=h(this.pos.x+n,this.pos.y-r);pt(o,a,e,t),pt(a,l,e,t),pt(l,c,e,t),pt(c,o,e,t)}if(this.isMoving){const t=new v().setHex("#00FF00"),e=h(.1,.1);me(this.pos,e,void 0,t)}}}function rr(i,t,e){const s={heavy_tank:Vn,missile_tank:$n,light_tank:jn,superheavy:Gn,howitzer:Kn,LAD:Yn,mobile_howitzer:Xn,GEV:Jn,light_GEV:Zn,GEV_carrier:Qn,infantry:tr,heavy_weapons_team:er,engineers:ir};return new nr(i,t,s[e])}const or=[{q:0,r:0,terrain:b},{q:1,r:0,terrain:b},{q:2,r:0,terrain:b},{q:3,r:0,terrain:L},{q:4,r:0,terrain:f},{q:5,r:0,terrain:f},{q:6,r:0,terrain:f},{q:7,r:0,terrain:f},{q:8,r:0,terrain:b},{q:9,r:0,terrain:b},{q:10,r:0,terrain:b},{q:11,r:0,terrain:b},{q:0,r:1,terrain:f},{q:1,r:1,terrain:f},{q:2,r:1,terrain:L},{q:3,r:1,terrain:f},{q:4,r:1,terrain:f},{q:5,r:1,terrain:f},{q:6,r:1,terrain:f},{q:7,r:1,terrain:f},{q:8,r:1,terrain:f},{q:9,r:1,terrain:f},{q:10,r:1,terrain:b},{q:11,r:1,terrain:b},{q:-1,r:2,terrain:_},{q:0,r:2,terrain:_},{q:1,r:2,terrain:_},{q:2,r:2,terrain:_},{q:3,r:2,terrain:_},{q:4,r:2,terrain:_},{q:5,r:2,terrain:_},{q:6,r:2,terrain:_},{q:7,r:2,terrain:_},{q:8,r:2,terrain:f},{q:9,r:2,terrain:f},{q:10,r:2,terrain:b},{q:-1,r:3,terrain:f},{q:0,r:3,terrain:f},{q:1,r:3,terrain:f},{q:2,r:3,terrain:L},{q:3,r:3,terrain:f},{q:4,r:3,terrain:f},{q:5,r:3,terrain:b},{q:6,r:3,terrain:b},{q:7,r:3,terrain:_},{q:8,r:3,terrain:f},{q:9,r:3,terrain:f},{q:10,r:3,terrain:b},{q:-2,r:4,terrain:b},{q:-1,r:4,terrain:f},{q:0,r:4,terrain:f},{q:1,r:4,terrain:f},{q:2,r:4,terrain:L},{q:3,r:4,terrain:L},{q:4,r:4,terrain:f},{q:5,r:4,terrain:Te},{q:6,r:4,terrain:Te},{q:7,r:4,terrain:_},{q:8,r:4,terrain:f},{q:9,r:4,terrain:f},{q:-2,r:5,terrain:b},{q:-1,r:5,terrain:f},{q:0,r:5,terrain:f},{q:1,r:5,terrain:f},{q:2,r:5,terrain:f},{q:3,r:5,terrain:L},{q:4,r:5,terrain:f},{q:5,r:5,terrain:f},{q:6,r:5,terrain:f},{q:7,r:5,terrain:_},{q:8,r:5,terrain:f},{q:9,r:5,terrain:b},{q:-3,r:6,terrain:b},{q:-2,r:6,terrain:f},{q:-1,r:6,terrain:f},{q:0,r:6,terrain:f},{q:1,r:6,terrain:wn},{q:2,r:6,terrain:f},{q:3,r:6,terrain:L},{q:4,r:6,terrain:L},{q:5,r:6,terrain:L},{q:6,r:6,terrain:b},{q:7,r:6,terrain:_},{q:8,r:6,terrain:_},{q:-3,r:7,terrain:f},{q:-2,r:7,terrain:f},{q:-1,r:7,terrain:b},{q:0,r:7,terrain:f},{q:1,r:7,terrain:f},{q:2,r:7,terrain:f},{q:3,r:7,terrain:b},{q:4,r:7,terrain:b},{q:5,r:7,terrain:L},{q:6,r:7,terrain:f},{q:7,r:7,terrain:f},{q:8,r:7,terrain:f},{q:-4,r:8,terrain:f},{q:-3,r:8,terrain:Te},{q:-2,r:8,terrain:b},{q:-1,r:8,terrain:b},{q:0,r:8,terrain:b},{q:1,r:8,terrain:f},{q:2,r:8,terrain:b},{q:3,r:8,terrain:b},{q:4,r:8,terrain:b},{q:5,r:8,terrain:L},{q:6,r:8,terrain:f},{q:7,r:8,terrain:b},{q:-4,r:9,terrain:f},{q:-3,r:9,terrain:f},{q:-2,r:9,terrain:b},{q:-1,r:9,terrain:b},{q:0,r:9,terrain:f},{q:1,r:9,terrain:b},{q:2,r:9,terrain:b},{q:3,r:9,terrain:f},{q:4,r:9,terrain:L},{q:5,r:9,terrain:f},{q:6,r:9,terrain:b},{q:7,r:9,terrain:b},{q:-5,r:10,terrain:b},{q:-4,r:10,terrain:f},{q:-3,r:10,terrain:b},{q:-2,r:10,terrain:b},{q:-1,r:10,terrain:f},{q:0,r:10,terrain:f},{q:1,r:10,terrain:f},{q:2,r:10,terrain:f},{q:3,r:10,terrain:L},{q:4,r:10,terrain:f},{q:5,r:10,terrain:f},{q:6,r:10,terrain:f},{q:-5,r:11,terrain:b},{q:-4,r:11,terrain:b},{q:-3,r:11,terrain:b},{q:-2,r:11,terrain:b},{q:-1,r:11,terrain:f},{q:0,r:11,terrain:f},{q:1,r:11,terrain:f},{q:2,r:11,terrain:b},{q:3,r:11,terrain:L},{q:4,r:11,terrain:f},{q:5,r:11,terrain:f},{q:6,r:11,terrain:f}],C=new je(ge,or.map(i=>ge.create({...i,cost:i.terrain.movementCost}))),ar=[{unit:"heavy_tank",side:"blue",pos:{col:1,row:1}},{unit:"infantry",side:"blue",pos:{col:0,row:0}},{unit:"missile_tank",side:"red",pos:{col:2,row:2}},{unit:"infantry",side:"red",pos:{col:10,row:10}}],cr={turn:1,movingPlayer:"blue",firingPlayer:"blue",phase:"movement",units:ar.map(i=>{const t=C.getHex(i.pos),e=h(t==null?void 0:t.x,t==null?void 0:t.y);return rr(e,i.side,i.unit)}),selectedUnit:void 0,selectedHex:void 0,reachableHexes:[],movementPath:[],combat:{selectedFiringUnit:void 0,validTargets:[],visibleHexes:[]}},u=new Ne(cr);var ft={},Si;function lr(){if(Si)return ft;Si=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.aStar=ft.MinHeap=void 0;const i=o=>Math.floor((o-1)/2),t=o=>2*o+1,e=o=>2*o+2;class s{constructor(a){this._getValue=a,this._heapArray=[],this._itemToIndex=new Map}upsert(a){const c=this._itemToIndex.get(a);c!==void 0?this._heapifyDownFromIndex(c):this.insert(a)}contains(a){return this._itemToIndex.get(a)!==void 0}insert(a){const{_getValue:c,_heapArray:l,_itemToIndex:d}=this;l.push(a);let p=this._heapArray.length-1;for(d.set(a,p);p!==0;){const m=i(p),x=l[m];if(c(x)<=c(l[p]))return;this._swapIndexes(p,m),p=m}}removeMinimum(){const{_heapArray:a,_itemToIndex:c}=this;if(a.length<=0)return;if(a.length===1)return c.delete(a[0]),a.pop();const l=a[0];return c.delete(l),a[0]=a.pop(),this._heapifyDownFromIndex(0),l}_swapIndexes(a,c){const{_heapArray:l,_itemToIndex:d}=this,p=l[a],m=l[c];d.set(p,c),d.set(m,a),l[a]=m,l[c]=p}_heapifyDownFromIndex(a){const{_heapArray:c,_getValue:l}=this,d=t(a),p=e(a);let m=a;const x=c.length;d<x&&l(c[d])<l(c[a])&&(m=d),p<x&&l(c[p])<l(c[m])&&(m=p),m!==a&&(this._swapIndexes(a,m),this._heapifyDownFromIndex(m))}}ft.MinHeap=s;function n({start:o,goal:a,estimateFromNodeToGoal:c,neighborsAdjacentToNode:l,actualCostToMove:d}){var p;const m=new Map,x=new Map;x.set(o,0);const S=new Map;S.set(o,c(o));const P=new s(q=>{var E;return(E=S.get(q))!==null&&E!==void 0?E:1/0});for(P.upsert(o);;){const q=P.removeMinimum();if(q===void 0)return;if(q===a)return r(m,q);const E=(p=x.get(q))!==null&&p!==void 0?p:1/0;l(q).forEach(I=>{var $;const xe=E+d(m,q,I),is=($=x.get(I))!==null&&$!==void 0?$:1/0;xe<is&&(m.set(I,q),x.set(I,xe),S.set(I,xe+c(I)),P.upsert(I))})}}ft.aStar=n;function r(o,a){const c=[a];for(;;){const l=o.get(a);if(l===void 0)return c.reverse();c.push(l),a=l}}return ft}var hr=lr();function Ct(){u.state.selectedUnit&&(u.state.selectedUnit.selected=!1,u.state.selectedUnit=void 0,u.state.reachableHexes=[],u.state.movementPath=[])}function Vt(){u.state.selectedUnit&&u.setState(i=>({...i,combat:{selectedFiringUnit:void 0,validTargets:[],hoveredTarget:void 0,visibleHexes:[]}}))}const Pe=new Map;function Qi(i,t){const e=`${i.q},${i.r},${t}`;if(Pe.has(e))return Pe.get(e);const s=new Map,n=[{tile:i,cost:0}],r=[];for(;n.length>0;){const{tile:c,cost:l}=n.shift(),d=`${c.q},${c.r}`;if(s.has(d)&&s.get(d)<=l)continue;s.set(d,l),r.push(c);const p=C.traverse(Zi({radius:1,center:c})).toArray();for(const m of p){const x=l+m.cost;x<=t&&n.push({tile:m,cost:x})}}const a={hexSet:new Set(s.keys()),tiles:r};return Pe.set(e,a),a}function ni(i,t){const e=C.getHex(i);if(!e){u.state.reachableHexes=[];return}const{tiles:s}=Qi(e,t);u.state.reachableHexes=s.map(({q:n,r})=>({q:n,r}))}function ts(i,t,e){const s=C.pointToHex(i),n=C.pointToHex(t),{hexSet:r}=Qi(s,e),o=`${n.q},${n.r}`;return r.has(o)?hr.aStar({start:s,goal:n,estimateFromNodeToGoal:c=>C.distance(c,n),neighborsAdjacentToNode:c=>C.traverse(Zi({radius:1,center:c})).toArray().filter(l=>r.has(`${l.q},${l.r}`)),actualCostToMove:(c,l,d)=>d.cost}):[]}function ur(i){if(!i.canBeSelected()){console.log("Unit cannot be selected (no movement or currently moving)");return}u.state.units.forEach(s=>s.selected=!1),i.selected=!0,u.state.selectedUnit=i;const t=i.getHexCoords(C),e=C.getHex(t);u.state.selectedHex=e,ni(t,i.remainingMovement)}function qi(i){const t=C.getHex({q:i.q,r:i.r});u.state.selectedHex=t}function dr(i,t){var n;if(i.isMoving)return;const e=C.pointToHex(t);if((n=u.state.reachableHexes)==null?void 0:n.some(r=>r.q===e.q&&r.r===e.r)){const r=ts(i.pos,t,i.movement);if(r){const o=r.slice(1).reduce((c,l)=>c+l.terrain.movementCost,0),a=r.map(c=>h(c.x,c.y));i.moveAnimated(a,o,c=>{if(c<=0)Ct();else{const l=i.getHexCoords(C);ni(l,c)}}),u.state.movementPath=[]}}else console.log("Target hex is not reachable")}let Zt=null,Ti=0;const fr=100,gr={update(){var i;if(u.state.phase==="movement"){if(Pt(0)){const t=C.pointToHex(O),{q:e,r:s,x:n,y:r}=t,o=u.state.units.find(a=>Math.abs(a.pos.x-n)<.1&&Math.abs(a.pos.y-r)<.1);if(o&&o.side===u.state.movingPlayer)if(u.state.selectedUnit===o){const a=o.remainingMovement,c=o.getHexCoords(C);ni(c,a)}else ur(o);else if(u.state.selectedUnit){const a=h(n,r);dr(u.state.selectedUnit,a),qi(t)}else qi(t)}if((Pt(2)||K("Escape"))&&(Ct(),u.state.selectedHex=void 0,Zt=null),u.state.selectedUnit&&!u.state.selectedUnit.isMoving){const t=Date.now(),e=C.pointToHex(O),s=`${e.q},${e.r}`;if(s!==Zt&&t>Ti)if(Zt=s,Ti=t+fr,(i=u.state.reachableHexes)==null?void 0:i.some(r=>r.q===e.q&&r.r===e.r)){const r=h(e.x,e.y),o=ts(u.state.selectedUnit.pos,r,u.state.selectedUnit.movement);u.state.movementPath=(o==null?void 0:o.map(a=>({x:a.x,y:a.y})))||[]}else u.state.movementPath=[]}else u.state.movementPath=[],Zt=null}}},pr={update(){if(!K("KeyN"))return;const i=u.state,t=e=>e==="blue"?"red":"blue";switch(i.phase){case"movement":Ct(),i.phase="fire",i.firingPlayer=i.movingPlayer;break;case"fire":if(i.firingPlayer===i.movingPlayer)Ct(),Vt(),i.firingPlayer=t(i.movingPlayer);else{Ct(),Vt(),i.units.forEach(s=>s.remainingMovement=s.movement);const e=t(i.movingPlayer);i.movingPlayer=e,i.firingPlayer=e,i.phase="movement",i.turn+=1}break;default:console.warn("Unknown phase:",i.phase);break}}};function mr(i){document.body.style.cursor=i}const Ft=class Ft{static init(){bn(),this.unitButtons=[],this.zoomButtons={out:null,in:null},this.createUI()}static createUI(){const t=st;this.uiRoot=new W,this.createActionBar(t),this.createStatusBar(t),this.updateLayout()}static createActionBar(t){const e=t.y-this.barHeight;this.actionBar=new W(h(0,e+this.actionBarHeight/2)),this.uiRoot&&this.uiRoot.addChild(this.actionBar);const s=new W(h(0,0),h(t.x,this.actionBarHeight));s.color=new v(.2,.2,.25,.9),s.lineWidth=0,this.actionBar.addChild(s);const n=new nt(h(-t.x/2+20,0),h(300,this.actionBarHeight),this.getPhaseText(),"left");n.textColor=new v(1,1,1),n.lineWidth=0,this.actionBar.addChild(n),this.createActionButtons(t)}static createActionButtons(t){const e=h(35,35),s=45,n=t.x/2-160;this.zoomButtons.out=new Xt(h(n,0),e,"Z-"),this.zoomButtons.out.color=new v(.3,.3,.4),this.zoomButtons.out.onPress=()=>{console.log("Zoom out pressed")},this.actionBar.addChild(this.zoomButtons.out),this.zoomButtons.in=new Xt(h(n+s,0),e,"Z+"),this.zoomButtons.in.color=new v(.3,.3,.4),this.zoomButtons.in.onPress=()=>{console.log("Zoom in pressed")},this.actionBar.addChild(this.zoomButtons.in),this.settingsButton=new Xt(h(n+s*2,0),e,"SET"),this.settingsButton.color=new v(.4,.3,.3),this.settingsButton.onPress=()=>{console.log("Settings pressed")},this.actionBar.addChild(this.settingsButton)}static createStatusBar(t){const e=t.y-this.statusBarHeight;this.statusBar=new W(h(0,e)),this.uiRoot&&this.uiRoot.addChild(this.statusBar);const s=new W(h(0,this.statusBarHeight/2),h(t.x,this.statusBarHeight));s.color=new v(.15,.15,.2,.95),s.lineWidth=2,s.lineColor=new v(.4,.4,.5,.8),this.statusBar.addChild(s),this.createUnitSelectorSection(t),this.createUnitInfoSection(t),this.createTerrainInfoSection(t),this.createCommsSection(t),this.createMinimapSection(t)}static createUnitSelectorSection(t){const n=-t.x/2+15+100,r=new W(h(n,this.statusBarHeight/2));this.statusBar.addChild(r);const o=new nt(h(0,-this.statusBarHeight/2+20),h(200,20),"UNITS","center");o.textColor=new v(.8,.8,.9),o.lineWidth=0,r.addChild(o),this.unitSelector=r,this.updateUnitButtons()}static updateUnitButtons(){if(!this.unitSelector)return;this.unitButtons&&this.unitButtons.forEach(l=>{this.unitSelector.removeChild(l)}),this.unitButtons=[];const e=u.state.phase==="movement"?u.state.movingPlayer:u.state.firingPlayer,s=u.state.units.filter(l=>l.side===e);if(s.length===0)return;const n=4,r=h(25,25),o=35,a=-75,c=-50;s.forEach((l,d)=>{const p=Math.floor(d/n),m=d%n,x=a+m*o,S=c+p*o,P=new Xt(h(x,S),r,l.type.substring(0,3).toUpperCase()),q=u.state.selectedUnit===l;P.color=q?new v(.6,.6,.2):new v(.3,.3,.4),P.onPress=()=>{this.selectUnit(l)},this.unitSelector.addChild(P),this.unitButtons.push(P)})}static selectUnit(t){console.log("Unit selected:",t.type),u.state.units.forEach(e=>e.selected=!1),t.selected=!0,u.state.selectedUnit=t,this.updateUnitButtons(),this.updateUnitInfo()}static createUnitInfoSection(t){const n=-t.x/2+15+200+15+125,r=new W(h(n,this.statusBarHeight/2));this.statusBar.addChild(r);const o=new nt(h(0,-this.statusBarHeight/2+20),h(250,20),"UNIT INFO","center");o.textColor=new v(.8,.8,.9),o.lineWidth=0,r.addChild(o),this.unitInfoSection=r,this.updateUnitInfo()}static updateUnitInfo(){if(!this.unitInfoSection)return;const t=u.state.selectedUnit;if([...this.unitInfoSection.children].slice(1).forEach(r=>{this.unitInfoSection.removeChild(r)}),!t)return;const s=new nt(h(-50,-30),h(200,20),t.type.toUpperCase(),"left");s.textColor=new v(1,1,.7),s.lineWidth=0,this.unitInfoSection.addChild(s),[`Firepower: ${t.firepower}`,`Range: ${t.range}`,`Defense: ${t.defense}`,`Movement: ${t.movement}`].forEach((r,o)=>{const a=new nt(h(-50,-5+o*18),h(200,15),r,"left");a.textColor=new v(.9,.9,.9),a.lineWidth=0,this.unitInfoSection.addChild(a)})}static createTerrainInfoSection(t){const n=-t.x/2+15+200+15+250+15+125,r=new W(h(n,this.statusBarHeight/2));this.statusBar.addChild(r);const o=new nt(h(0,-this.statusBarHeight/2+20),h(250,20),"TERRAIN","center");o.textColor=new v(.8,.8,.9),o.lineWidth=0,r.addChild(o),this.terrainInfoSection=r}static createCommsSection(t){const n=t.x/2-15-150-100,r=new W(h(n,this.statusBarHeight/2));this.statusBar.addChild(r);const o=new nt(h(0,-this.statusBarHeight/2+20),h(200,20),"COMMS","center");o.textColor=new v(.8,.8,.9),o.lineWidth=0,r.addChild(o),this.commsSection=r}static createMinimapSection(t){const n=t.x/2-15-75,r=new W(h(n,this.statusBarHeight/2));this.statusBar.addChild(r);const o=new nt(h(0,-this.statusBarHeight/2+20),h(150,20),"MINIMAP","center");o.textColor=new v(.8,.8,.9),o.lineWidth=0,r.addChild(o);const a=new W(h(0,20),h(130,this.statusBarHeight-50));a.color=new v(.1,.2,.1),a.onPress=()=>{console.log("Minimap clicked at:",bt)},r.addChild(a),this.minimapSection=r}static getPhaseText(){const t=u.state.phase;return`Player ${t==="movement"?u.state.movingPlayer:u.state.firingPlayer} | ${t.toUpperCase()} PHASE`}static updateLayout(){if(!this.uiRoot)return;const t=st;if(this.uiRoot.pos.x=t.x/2,this.uiRoot.pos.y=0,this.actionBar&&this.actionBar.children.length>1){const e=this.actionBar.children[1];e instanceof nt&&(e.text=this.getPhaseText())}}static update(){this.updateLayout()}static destroy(){this.unitButtons&&(this.unitButtons=[]),this.uiRoot=null}};Ft.barHeight=200,Ft.actionBarHeight=50,Ft.statusBarHeight=150;let pe=Ft;const Ut=new Map;let Ci;function Ie(i,t){var e;return((e=qn[i])==null?void 0:e[t])??0}function yr(i,t){return`${i.q},${i.r}->${t.q},${t.r}`}function xr(){Ut.clear()}function vr(i,t){const e=C.distance(i,t),s=[];if(e<=1)return s;for(let n=1;n<e;n++){const r=n/e,o={x:i.q,y:-i.q-i.r,z:i.r},a={x:t.q,y:-t.q-t.r,z:t.r},c=o.x+(a.x-o.x)*r,l=o.y+(a.y-o.y)*r,d=o.z+(a.z-o.z)*r,p=br({x:c,y:l,z:d}),m={q:p.x,r:p.z},x=C.getHex(m);x&&!s.some(S=>S.q===x.q&&S.r===x.r)&&s.push(x)}return s}function br(i){let t=Math.round(i.x),e=Math.round(i.y),s=Math.round(i.z);const n=Math.abs(t-i.x),r=Math.abs(e-i.y),o=Math.abs(s-i.z);return n>r&&n>o?t=-e-s:r>o?e=-t-s:s=-t-e,{x:t,y:e,z:s}}function ri(i,t){if(C.distance(i,t)<=1)return{hasLOS:!0};const s=yr(i,t);if(Ut.has(s))return{hasLOS:Ut.get(s)};const n=Ie(i.terrain.type,"firing"),r=Ie(t.terrain.type,"target"),o=vr(i,t);for(const a of o){const c=Ie(a.terrain.type,"intervening");if(c>n&&c>r)return Ut.set(s,!1),{hasLOS:!1}}return Ut.set(s,!0),{hasLOS:!0}}function es(i,t){const e=C.pointToHex(i.pos),s=C.pointToHex(t.pos);return ri(e,s)}function wr(i,t){const e=[];for(const s of t){if(s===i)continue;es(s,i).hasLOS&&e.push(s)}return e}function Sr(i){const t=C.pointToHex(i.pos),e=[];for(const s of C)ri(t,s).hasLOS&&e.push({q:s.q,r:s.r});return e}function qr(i){const e=u.state.units.filter(s=>s.side!==i.side).filter(s=>{const n=C.pointToHex(i.pos),r=C.pointToHex(s.pos);return C.distance(n,r)<=i.range});return wr(i,e)}function Tr(i){u.state.phase!=="fire"||i.side!==u.state.firingPlayer||(u.state.units.forEach(t=>t.selected=!1),Vt(),i.selected=!0,u.state.selectedUnit=i,u.setState(t=>({...t,combat:{...t.combat,selectedFiringUnit:i,validTargets:qr(i),visibleHexes:Sr(i)}})))}const Cr={update(){if(u.state.phase==="fire"){if(Pt(0)){const s=C.pointToHex(O),{x:n,y:r}=s,o=u.state.units.find(a=>Math.abs(a.pos.x-n)<.1&&Math.abs(a.pos.y-r)<.1);o&&(o.side===u.state.firingPlayer?Tr(o):u.state.selectedUnit&&u.state.combat.validTargets.includes(o)&&console.log("Initiating combat!",{attacker:u.state.combat.selectedFiringUnit,target:o}))}(Pt(2)||K("Escape"))&&(Ct(),Vt());const i=C.pointToHex(O),t=u.state.units.find(s=>Math.abs(s.pos.x-i.x)<.1&&Math.abs(s.pos.y-i.y)<.1),e=t&&u.state.selectedUnit&&u.state.combat.validTargets.includes(t)?"crosshair":"default";Ci!==e&&(mr(e),Ci=e)}},getSelectedFiringUnit:()=>u.state.combat.selectedFiringUnit,getValidTargets:()=>u.state.combat.validTargets,getVisibleHexes:()=>u.state.combat.visibleHexes,clearFiringSelection:Vt,calculateLOS:ri,calculateLOSBetweenUnits:es,clearLOSCache:xr};function Pr(){Pi(),Ms(h(9,8)),Ei(50),u.state.units,pe.init(),window.addEventListener("resize",Pi)}function Pi(){const i=window.innerWidth,t=window.innerHeight;Hs(h(i,t))}function Ir(){if(re){const i=M(B*(1-re/10),50,150);Ei(i)}Q("KeyW")&&(A.y=Math.min(18,A.y+.5)),Q("KeyS")&&(A.y=Math.max(0,A.y-.5)),Q("KeyA")&&(A.x=Math.max(0,A.x-.5)),Q("KeyD")&&(A.x=Math.min(20,A.x+.5)),pr.update(),gr.update(),Cr.update()}function Mr(){}function Hr(){var n,r;const i=new Set((n=u.state.reachableHexes)==null?void 0:n.map(o=>`${o.q},${o.r}`)),t=new Set((r=u.state.combat.visibleHexes)==null?void 0:r.map(o=>`${o.q},${o.r}`)),e=u.state.phase==="movement",s=u.state.phase==="fire";for(const o of C){const c=o.corners.map(m=>h(m.x,m.y));let l=new v().setHex(Sn[o.terrain.type]),d=new v(0,0,0),p=.05;if(u.state.selectedHex&&o==u.state.selectedHex&&(l=l.scale(1.2)),e&&u.state.selectedUnit){const m=`${o.q},${o.r}`;i.has(m)?l=l.scale(1.1):l=l.scale(.8)}if(s&&u.state.selectedUnit){const m=`${o.q},${o.r}`;t.has(m)?l=l.scale(1.1):l=l.scale(.8)}Os(c,l,p,d)}if(u.state.movementPath&&u.state.movementPath.length>1){const o=new v().setHex("#FFFF00"),a=.1;for(let c=0;c<u.state.movementPath.length-1;c++){const l=u.state.movementPath[c],d=u.state.movementPath[c+1];pt(h(l.x,l.y),h(d.x,d.y),a,o)}u.state.movementPath.forEach((c,l)=>{if(l>0){const d=new v().setHex("#FF8800"),p=h(.15,.15);me(h(c.x,c.y),p,void 0,d)}})}}function Dr(){pe.update()}pn(Pr,Ir,Mr,Hr,Dr,["tiles.png"]);
